# Loki configuration - Using DigitalOcean Spaces (object storage)
# Using this configuration can avoid SingleBinary mode validation issues

# Use SimpleScalable mode (default mode, no special configuration needed)
deploymentMode: SimpleScalable

# SimpleScalable mode configuration
simpleScalable:
  enabled: true
  replicas: 1  # Can be adjusted as needed

# Disable SingleBinary mode
singleBinary:
  enabled: false
  replicas: 0

# Loki storage configuration - DigitalOcean Spaces (S3 compatible)
loki:
  auth_enabled: false
  commonConfig:
    replication_factor: 1
  storage:
    type: s3
    bucketNames:
      chunks: loki-storage  # ⚠️ Replace with your Spaces name
      ruler: loki-storage   # ⚠️ Replace with your Spaces name
    s3:
      # ⚠️ Replace with your Spaces region endpoint
      # Common endpoints:
      # - nyc3.digitaloceanspaces.com (New York 3)
      # - sfo3.digitaloceanspaces.com (San Francisco 3)
      # - sgp1.digitaloceanspaces.com (Singapore 1)
      # - ams3.digitaloceanspaces.com (Amsterdam 3)
      # - fra1.digitaloceanspaces.com (Frankfurt 1)
      endpoint: nyc3.digitaloceanspaces.com
      region: nyc3  # ⚠️ Replace with your Spaces region
      s3ForcePathStyle: true
      secretAccessKey:
        name: loki-spaces-credentials  # Kubernetes Secret name
        key: AWS_SECRET_ACCESS_KEY
      accessKeyId:
        name: loki-spaces-credentials  # Kubernetes Secret name
        key: AWS_ACCESS_KEY_ID
  limits_config:
    retention_period: 720h
    ingestion_rate_mb: 16
    ingestion_burst_size_mb: 32
    max_query_parallelism: 32
    max_query_series: 500

# Persistent storage (for index, not log data)
# Index data is small, 10Gi is sufficient
persistence:
  enabled: true
  storageClassName: do-block-storage
  size: 10Gi

# Resource limits
resources:
  requests:
    cpu: 200m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 2Gi

# Service configuration
service:
  type: ClusterIP
  port: 3100

# Cache components (can be used in SimpleScalable mode to improve performance)
chunksCache:
  enabled: true
  replicas: 1

resultsCache:
  enabled: true
  replicas: 1

# Gateway (recommended for SimpleScalable mode)
gateway:
  enabled: true

# Canary (optional, for testing)
canary:
  enabled: false

