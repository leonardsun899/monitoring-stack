# Loki 配置 - 使用默认 SimpleScalable 模式（需要 S3）
# 尽量使用 Helm Chart 默认配置，只覆盖必要的 S3 设置
#
# 支持两种 S3 访问方式：
# 1. IRSA (IAM Roles for Service Accounts) - 推荐，不需要 Secret
# 2. IAM 用户访问密钥 - 需要创建 Kubernetes Secret
#
# 如果使用 Terraform 部署，以下值会自动填充：
# - bucketNames: 从 Terraform 输出获取
# - region: 从 Terraform 输出获取
# - serviceAccount.name: 从 Terraform 输出获取

# 使用默认的 SimpleScalable 模式
deploymentMode: SimpleScalable

# Loki 存储配置 - AWS S3
loki:
  auth_enabled: false
  storage:
    type: s3
    bucketNames:
      chunks: ${LOKI_S3_BUCKET_NAME} # 从 Terraform 输出获取，或手动替换
      ruler: ${LOKI_S3_BUCKET_NAME} # 从 Terraform 输出获取，或手动替换
    s3:
      endpoint: s3.amazonaws.com # AWS S3 端点
      region: ${AWS_REGION} # 从 Terraform 输出获取，或手动替换（例如：us-west-2）
      s3ForcePathStyle: false
      # 如果使用 IRSA，不需要配置 accessKeyId 和 secretAccessKey
      # AWS SDK 会自动从 Pod 的 ServiceAccount 获取临时凭证
      #
      # 如果使用 IAM 用户访问密钥，取消下面的注释并配置：
      # secretAccessKey:
      #   name: loki-s3-credentials  # Kubernetes Secret 名称
      #   key: AWS_SECRET_ACCESS_KEY
      # accessKeyId:
      #   name: loki-s3-credentials  # Kubernetes Secret 名称
      #   key: AWS_ACCESS_KEY_ID

# 持久化存储（用于索引，不是日志数据）
persistence:
  enabled: true
  storageClassName: gp3
  size: 10Gi

# ServiceAccount 配置（如果使用 IRSA）
# Terraform 会自动创建 ServiceAccount 并关联 IAM Role
# 如果使用 Terraform 部署，取消下面的注释：
serviceAccount:
  create: false # 不自动创建 ServiceAccount（Terraform 已创建）
  name: loki-s3-service-account # 使用 Terraform 创建的 ServiceAccount（已配置 IRSA）

