# Grafana 配置
# 注意：这是独立的 Grafana 部署，不依赖 kube-prometheus-stack

# 管理员凭据
admin:
  user: admin
  password: admin  # 生产环境请使用强密码

# 持久化存储
persistence:
  enabled: true
  storageClassName: do-block-storage
  size: 10Gi

# 资源限制
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

# Service 配置
service:
  type: LoadBalancer  # 测试环境使用 LoadBalancer，生产环境建议使用 ClusterIP + ALB
  port: 80

# 数据源配置
datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        # 标准 Prometheus chart 的 Service 名称格式：{release-name}-prometheus-server
        # 由于 ArgoCD application 名称是 prometheus，所以 Service 名称是 prometheus-prometheus-server
        # 标准 Prometheus chart 默认端口是 9090
        url: http://prometheus-prometheus-server.monitoring.svc:9090
        isDefault: true
        editable: true
      - name: Loki
        type: loki
        access: proxy
        url: http://loki.monitoring.svc:3100
        isDefault: false  # 重要：只能有一个数据源是默认的
        editable: true

# Dashboard 配置
dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: "default"
        orgId: 1
        folder: ""
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/default

# 预安装的 Dashboards
dashboards:
  default:
    kubernetes-cluster-monitoring:
      gnetId: 7249
      revision: 1
      datasource: Prometheus
    node-exporter:
      gnetId: 1860
      revision: 27
      datasource: Prometheus
    nginx-exporter:
      gnetId: 12708
      revision: 1
      datasource: Prometheus
    loki-logs:
      gnetId: 13639
      revision: 1
      datasource: Loki

