# ä¸ºä»€ä¹ˆéœ€è¦æ˜¾å¼è®¾ç½® `replicas: 0`ï¼Ÿ

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

åœ¨ Loki Helm Chart ä¸­ï¼Œå³ä½¿è®¾ç½®äº† `simpleScalable.enabled: false`ï¼Œå¦‚æœä¸æ˜¾å¼è®¾ç½® `replicas: 0`ï¼Œä»ç„¶ä¼šå‡ºç°éªŒè¯é”™è¯¯ï¼š

```
Error: execution error at (loki/templates/validate.yaml:31:4): 
You have more than zero replicas configured for both the single binary 
and simple scalable targets.
```

## ğŸ” åŸå› åˆ†æ

### 1. Helm Chart çš„éªŒè¯é€»è¾‘

Loki Helm Chart åœ¨ `templates/validate.yaml` ä¸­æœ‰ä¸€ä¸ªéªŒè¯æ¨¡æ¿ï¼Œå®ƒåœ¨**æ¸²æŸ“æ‰€æœ‰èµ„æºä¹‹å‰**å°±ä¼šæ‰§è¡Œã€‚è¿™ä¸ªéªŒè¯é€»è¾‘ä¼šæ£€æŸ¥ï¼š

```yaml
# ä¼ªä»£ç ï¼ˆHelm Chart éªŒè¯é€»è¾‘ï¼‰
{{- if and (gt .Values.singleBinary.replicas 0) (gt .Values.simpleScalable.replicas 0) }}
  {{- fail "You have more than zero replicas configured for both..." }}
{{- end }}
```

**å…³é”®ç‚¹**ï¼šéªŒè¯é€»è¾‘**åªæ£€æŸ¥ `replicas` çš„å€¼**ï¼Œ**ä¸æ£€æŸ¥ `enabled` çš„å€¼**ï¼

### 2. `enabled` å’Œ `replicas` æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„é…ç½®

åœ¨ Helm Chart ä¸­ï¼Œ`enabled` å’Œ `replicas` æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„é…ç½®é¡¹ï¼š

- **`enabled: false`** â†’ å‘Šè¯‰æ¨¡æ¿"ä¸è¦åˆ›å»ºè¿™ä¸ªç»„ä»¶çš„èµ„æº"
- **`replicas: 0`** â†’ å‘Šè¯‰éªŒè¯é€»è¾‘"è¿™ä¸ªç»„ä»¶çš„å‰¯æœ¬æ•°æ˜¯ 0"

**é—®é¢˜**ï¼šå³ä½¿ `enabled: false`ï¼Œå¦‚æœ `replicas` æ²¡æœ‰æ˜¾å¼è®¾ç½®ï¼ŒHelm ä¼šä½¿ç”¨**é»˜è®¤å€¼**ï¼Œè€Œé»˜è®¤å€¼å¯èƒ½ä¸æ˜¯ 0ï¼

### 3. Helm çš„é»˜è®¤å€¼æœºåˆ¶

å½“ä½ åœ¨ `values.yaml` ä¸­ä¸æŒ‡å®šæŸä¸ªå€¼æ—¶ï¼ŒHelm ä¼šä½¿ç”¨ Chart çš„é»˜è®¤å€¼ï¼ˆå®šä¹‰åœ¨ `values.yaml` ä¸­ï¼‰ã€‚ä¾‹å¦‚ï¼š

```yaml
# Loki Helm Chart çš„é»˜è®¤ values.yamlï¼ˆç®€åŒ–ç‰ˆï¼‰
simpleScalable:
  enabled: true  # é»˜è®¤å¯ç”¨
  replicas: 1    # é»˜è®¤å‰¯æœ¬æ•°æ˜¯ 1ï¼Œä¸æ˜¯ 0ï¼
```

**å³ä½¿ä½ è®¾ç½®äº† `enabled: false`**ï¼Œå¦‚æœä½ æ²¡æœ‰æ˜¾å¼è¦†ç›– `replicas`ï¼ŒHelm ä»ç„¶ä¼šä½¿ç”¨é»˜è®¤å€¼ `replicas: 1`ã€‚

### 4. éªŒè¯æ¨¡æ¿çš„æ‰§è¡Œé¡ºåº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Helm è¯»å–ä½ çš„ values.yaml                       â”‚
â”‚   simpleScalable:                                       â”‚
â”‚     enabled: false  âœ… ä½ è®¾ç½®äº†                          â”‚
â”‚     replicas: ???  âŒ ä½ æ²¡æœ‰è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼ 1          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Helm åˆå¹¶é»˜è®¤å€¼å’Œä½ çš„å€¼                         â”‚
â”‚   simpleScalable:                                       â”‚
â”‚     enabled: false  âœ… ä½ çš„å€¼è¦†ç›–äº†é»˜è®¤å€¼               â”‚
â”‚     replicas: 1    âŒ ä½¿ç”¨é»˜è®¤å€¼ï¼ˆå› ä¸ºä½ æ²¡è®¾ç½®ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: éªŒè¯æ¨¡æ¿æ‰§è¡Œï¼ˆåœ¨æ¸²æŸ“èµ„æºä¹‹å‰ï¼‰                   â”‚
â”‚   æ£€æŸ¥: singleBinary.replicas > 0? âœ… Yes (1)            â”‚
â”‚   æ£€æŸ¥: simpleScalable.replicas > 0? âœ… Yes (1)         â”‚
â”‚   ç»“æœ: âŒ é”™è¯¯ï¼ä¸¤ä¸ªéƒ½å¤§äº 0                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: éªŒè¯å¤±è´¥ï¼ŒHelm åœæ­¢æ‰§è¡Œ                          â”‚
â”‚   ä¸ä¼šåˆ›å»ºä»»ä½•èµ„æº                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. ä¸ºä»€ä¹ˆéªŒè¯é€»è¾‘ä¸æ£€æŸ¥ `enabled`ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªè®¾è®¡é€‰æ‹©ã€‚éªŒè¯é€»è¾‘çš„ç›®çš„æ˜¯**é˜²æ­¢é…ç½®å†²çª**ï¼Œè€Œä¸æ˜¯æ£€æŸ¥"æ˜¯å¦å¯ç”¨"ã€‚

**åŸå› **ï¼š
- éªŒè¯é€»è¾‘åœ¨**æ¨¡æ¿æ¸²æŸ“ä¹‹å‰**æ‰§è¡Œ
- æ­¤æ—¶è¿˜ä¸çŸ¥é“å“ªäº›èµ„æºä¼šè¢«åˆ›å»ºï¼ˆå› ä¸º `enabled` æ˜¯åœ¨æ¨¡æ¿æ¸²æŸ“æ—¶æ£€æŸ¥çš„ï¼‰
- éªŒè¯é€»è¾‘åªå…³å¿ƒ"é…ç½®æ˜¯å¦å†²çª"ï¼Œä¸å…³å¿ƒ"æ˜¯å¦å¯ç”¨"

## âœ… è§£å†³æ–¹æ¡ˆ

### æ˜¾å¼è®¾ç½® `replicas: 0`

```yaml
simpleScalable:
  enabled: false
  replicas: 0  # âœ… å¿…é¡»æ˜¾å¼è®¾ç½®ä¸º 0
```

**ä¸ºä»€ä¹ˆè¿™æ ·æœ‰æ•ˆï¼Ÿ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Helm è¯»å–ä½ çš„ values.yaml                       â”‚
â”‚   simpleScalable:                                       â”‚
â”‚     enabled: false  âœ… ä½ è®¾ç½®äº†                          â”‚
â”‚     replicas: 0    âœ… ä½ æ˜¾å¼è®¾ç½®äº† 0                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Helm åˆå¹¶é»˜è®¤å€¼å’Œä½ çš„å€¼                         â”‚
â”‚   simpleScalable:                                       â”‚
â”‚     enabled: false  âœ… ä½ çš„å€¼è¦†ç›–äº†é»˜è®¤å€¼               â”‚
â”‚     replicas: 0    âœ… ä½ çš„å€¼è¦†ç›–äº†é»˜è®¤å€¼                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: éªŒè¯æ¨¡æ¿æ‰§è¡Œ                                    â”‚
â”‚   æ£€æŸ¥: singleBinary.replicas > 0? âœ… Yes (1)            â”‚
â”‚   æ£€æŸ¥: simpleScalable.replicas > 0? âŒ No (0)          â”‚
â”‚   ç»“æœ: âœ… é€šè¿‡ï¼åªæœ‰ä¸€ä¸ªå¤§äº 0                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: éªŒè¯é€šè¿‡ï¼Œç»§ç»­æ¸²æŸ“èµ„æº                          â”‚
â”‚   å› ä¸º enabled: falseï¼Œä¸ä¼šåˆ›å»º simpleScalable èµ„æº     â”‚
â”‚   åªåˆ›å»º singleBinary èµ„æº                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š å¯¹æ¯”ç¤ºä¾‹

### âŒ é”™è¯¯é…ç½®ï¼ˆä¼šå¯¼è‡´éªŒè¯å¤±è´¥ï¼‰

```yaml
deploymentMode: SingleBinary
singleBinary:
  enabled: true
  replicas: 1

simpleScalable:
  enabled: false
  # replicas æ²¡æœ‰è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼ 1
```

**ç»“æœ**ï¼š
- éªŒè¯é€»è¾‘çœ‹åˆ°ï¼š`singleBinary.replicas = 1` å’Œ `simpleScalable.replicas = 1`ï¼ˆé»˜è®¤å€¼ï¼‰
- éªŒè¯å¤±è´¥ï¼šä¸¤ä¸ªéƒ½å¤§äº 0ï¼Œå†²çªï¼

### âœ… æ­£ç¡®é…ç½®ï¼ˆéªŒè¯é€šè¿‡ï¼‰

```yaml
deploymentMode: SingleBinary
singleBinary:
  enabled: true
  replicas: 1

simpleScalable:
  enabled: false
  replicas: 0  # âœ… æ˜¾å¼è®¾ç½®ä¸º 0
```

**ç»“æœ**ï¼š
- éªŒè¯é€»è¾‘çœ‹åˆ°ï¼š`singleBinary.replicas = 1` å’Œ `simpleScalable.replicas = 0`
- éªŒè¯é€šè¿‡ï¼šåªæœ‰ä¸€ä¸ªå¤§äº 0
- æ¨¡æ¿æ¸²æŸ“æ—¶ï¼šå› ä¸º `enabled: false`ï¼Œä¸ä¼šåˆ›å»º simpleScalable èµ„æº

## ğŸ¯ å…³é”®è¦ç‚¹

1. **`enabled: false` ä¸ç­‰äº `replicas: 0`**
   - `enabled` æ§åˆ¶æ˜¯å¦åˆ›å»ºèµ„æº
   - `replicas` æ§åˆ¶å‰¯æœ¬æ•°é‡
   - éªŒè¯é€»è¾‘åªæ£€æŸ¥ `replicas`ï¼Œä¸æ£€æŸ¥ `enabled`

2. **Helm çš„é»˜è®¤å€¼æœºåˆ¶**
   - å¦‚æœä½ ä¸è®¾ç½®æŸä¸ªå€¼ï¼ŒHelm ä¼šä½¿ç”¨ Chart çš„é»˜è®¤å€¼
   - é»˜è®¤å€¼å¯èƒ½ä¸æ˜¯ 0ï¼ˆä¾‹å¦‚ `replicas: 1`ï¼‰

3. **éªŒè¯é€»è¾‘çš„æ‰§è¡Œæ—¶æœº**
   - éªŒè¯åœ¨æ¨¡æ¿æ¸²æŸ“**ä¹‹å‰**æ‰§è¡Œ
   - æ­¤æ—¶è¿˜ä¸çŸ¥é“å“ªäº›èµ„æºä¼šè¢«åˆ›å»º
   - åªæ£€æŸ¥é…ç½®å€¼æ˜¯å¦å†²çª

4. **æœ€ä½³å®è·µ**
   - å½“ç¦ç”¨æŸä¸ªç»„ä»¶æ—¶ï¼Œ**åŒæ—¶è®¾ç½® `enabled: false` å’Œ `replicas: 0`**
   - è¿™æ ·å¯ä»¥ï¼š
     - é€šè¿‡éªŒè¯é€»è¾‘ï¼ˆ`replicas: 0`ï¼‰
     - ä¸åˆ›å»ºèµ„æºï¼ˆ`enabled: false`ï¼‰

## ğŸ’¡ ç±»æ¯”ç†è§£

æƒ³è±¡ä½ åœ¨å¡«å†™ä¸€ä¸ªè¡¨å•ï¼š

- **`enabled: false`** = "æˆ‘ä¸æƒ³è¦è¿™ä¸ªåŠŸèƒ½"ï¼ˆå‘Šè¯‰ç³»ç»Ÿä¸è¦åˆ›å»ºï¼‰
- **`replicas: 0`** = "å¦‚æœåˆ›å»ºäº†ï¼Œæ•°é‡æ˜¯ 0"ï¼ˆå‘Šè¯‰éªŒè¯ç³»ç»Ÿæ•°é‡ï¼‰

**é—®é¢˜**ï¼šéªŒè¯ç³»ç»Ÿåœ¨æ£€æŸ¥è¡¨å•æ—¶ï¼Œåªçœ‹åˆ°"æ•°é‡"å­—æ®µï¼Œä¸çœ‹"æ˜¯å¦æƒ³è¦"å­—æ®µã€‚å¦‚æœ"æ•°é‡"å­—æ®µæ˜¯ç©ºçš„ï¼Œç³»ç»Ÿä¼šå¡«å…¥é»˜è®¤å€¼ï¼ˆæ¯”å¦‚ 1ï¼‰ï¼Œç„¶åå‘ç°å†²çªã€‚

**è§£å†³**ï¼šå³ä½¿"ä¸æƒ³è¦"ï¼Œä¹Ÿè¦åœ¨"æ•°é‡"å­—æ®µæ˜ç¡®å†™ä¸Š 0ï¼Œè¿™æ ·éªŒè¯ç³»ç»Ÿå°±ä¸ä¼šå¡«å…¥é»˜è®¤å€¼ï¼Œä¹Ÿä¸ä¼šå‘ç°å†²çªã€‚

---

## ğŸ“š å‚è€ƒ

- [Loki Helm Chart æºç ](https://github.com/grafana/helm-charts/tree/main/charts/loki)
- [Helm Values è¦†ç›–æœºåˆ¶](https://helm.sh/docs/chart_best_practices/values/)
- [Helm Template æ‰§è¡Œé¡ºåº](https://helm.sh/docs/chart_template_guide/control_structures/)

